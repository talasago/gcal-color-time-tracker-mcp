# Development Dockerfile with live reloading capabilities
FROM ruby:3.2-alpine

# Install system dependencies including development tools
RUN apk add --no-cache \
    build-base \
    git \
    ca-certificates \
    tzdata \
    bash \
    vim

# Set working directory
WORKDIR /app

# Copy Gemfile and install gems (including development gems)
COPY Gemfile* ./
RUN bundle config set --local without '' && \
    bundle install

# Create user_tokens directory
RUN mkdir -p user_tokens

# Create non-root user for security
RUN addgroup -g 1000 app && \
    adduser -D -s /bin/sh -u 1000 -G app app && \
    chown -R app:app /app

USER app

# Set environment for development
ENV RACK_ENV=development
ENV DEBUG=true

# Default command for development
CMD ["bundle", "exec", "ruby", "bin/calendar-color-mcp"]